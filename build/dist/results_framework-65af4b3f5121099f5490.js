(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"4L+s":function(e,t,r){"use strict";r.d(t,"b",function(){return f}),r.d(t,"a",function(){return v});var o=r("q1tI"),a=r.n(o),n=r("i8i4"),l=r.n(n);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function r(e){var t;return s(this,r),(t=u(this,p(r).call(this,e))).content=e.content,t.placement=e.placement||null,t}var t,o,n;return d(r,a.a.Component),t=r,(o=[{key:"render",value:function(){return a.a.createElement("a",{tabIndex:"0","data-toggle":"popover","data-trigger":"focus","data-html":"true","data-placement":this.placement,"data-content":this.content},a.a.createElement("i",{className:"far fa-question-circle"}))}}])&&c(t.prototype,o),n&&c(t,n),r}(),v=function(e){function i(){var e,r;s(this,i);for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];return(r=u(this,(e=p(i)).call.apply(e,[this].concat(o)))).popoverName="base",r.componentDidMount=function(){r.bodyClickHandler=function(e){0==$("#".concat(r.popoverName,"_popover_content")).parent().find($(e.target)).length&&$(r.refs.target).popover("hide")};var t=function(){$("body").on("click",r.bodyClickHandler),$(r.refs.target).popover("update").on("hide.bs.popover",function(){$("body").off("click",r.bodyClickHandler)})};$(r.refs.target).popover({content:'<div id="'.concat(r.popoverName,'_popover_content"></div>'),html:!0,placement:"bottom"}).on("shown.bs.popover",function(e){l.a.render(r.getPopoverContent(),document.querySelector("#".concat(r.popoverName,"_popover_content")),t)})},r.getPopoverContent=function(){throw new Error("not implemented")},r}return d(i,a.a.Component),i}()},Ez0T:function(e,t,r){"use strict";var o=r("q1tI"),i=r.n(o),a=r("y2Vs"),n=r("VCnP"),l=r.n(n),s=0;function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"id";return s++,"".concat(e).concat(s)}var u=r("v38i");function p(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(e){f(t,e,r[e])})}return t}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"d",function(){return v}),r.d(t,"a",function(){return h}),r.d(t,"c",function(){return y}),r.d(t,"b",function(){return S});var v=function(e){var t=c("react-select"),r=e.labelClasses||"col-form-label text-uppercase",o=e.formRowClasses||"form-row mb-3",n=e.selectClasses||"tola-react-select";return i.a.createElement("div",{className:o},i.a.createElement("label",{htmlFor:t,className:r},e.label),i.a.createElement(a.default,{onChange:e.update,value:e.value,id:t,className:n,isDisabled:e.disabled,options:e.options}))},h=function(e){var t=c("date-select"),r=e.options&&1==e.options.length&&void 0!==e.options[0].value?i.a.createElement("option",{value:e.options[0].value},e.options[0].label):e.options&&0<e.options.length&&e.options[0].options&&void 0!==e.options[0].options?e.options.map(function(e,t){return i.a.createElement("optgroup",{label:e.label,key:t},e.options.map(function(e){return i.a.createElement("option",{value:e.value,key:e.value},e.label)}))}):e.options.map(function(e,t){return i.a.createElement("option",{value:e.value,key:t},e.label)});return i.a.createElement("div",{className:"form-row mb-3"},i.a.createElement("label",{htmlFor:t,className:"col-form-label text-uppercase"},e.label),i.a.createElement("select",{className:"form-control",id:t,value:e.value,onChange:e.update,disabled:e.disabled},r))},b=function(e){var t=c("react-select"),r=e.formGroupClass||"form-row mb-3",o=e.labelClass||"col-form-label text-uppercase",n=e.selectClass||"form-control";return i.a.createElement("div",{className:r},i.a.createElement("label",{htmlFor:t,className:o},e.label),i.a.createElement("select",{onChange:e.update,value:e.value,id:t,className:n,disabled:e.disabled},e.options))},g=function(e){return""==e.children?i.a.createElement("div",null):i.a.createElement(i.a.Fragment,null,i.a.createElement("hr",{style:{margin:"3px 0px 0px 0px"}}),i.a.createElement("div",{className:"text-muted",style:{textTransform:"uppercase",paddingLeft:"4px",marginBottom:"2px"}},e.children))},y=function(t){var e=c("multiselect"),r=t.options&&0!=t.options.length?{isMulti:!0,options:t.options,getDropdownButtonLabel:function(e){return e.value?Array.isArray(e.value)?0==e.value.length?gettext("None selected"):1==e.value.length?e.value[0].label:"".concat(e.value.length,"  ").concat(gettext("selected")):e.value.label:gettext("None selected")}}:{getDropdownButtonLabel:function(){return gettext("None available")},isDisabled:!0,menuIsOpen:!1,options:[]},o={dropdownButton:function(e){return t.options&&0!=t.options.length?e:m({},e,{backgroundColor:"#E5E6E8",background:""})},option:function(e,t){return m({},e,{padding:"1px 12px",display:"inline-block"})},container:function(e,t){return m({},e,{backgroundColor:"#f5f5f5"})}};return i.a.createElement("div",{className:"form-row mb-2 tola-react-multiselect-row"},i.a.createElement("label",{htmlFor:e,className:"col-form-label text-uppercase"},t.label),i.a.createElement(l.a,d({id:e,styles:o,formatOptionLabel:function(e){return i.a.createElement("div",{style:{display:"inline-block",float:"right",width:"90%"}},e.label)},components:{GroupHeading:g},value:t.value,onChange:t.update},r)))},S=function(e){var t=e.chainLabel,r=p(e,["chainLabel"]),o=[i.a.createElement("option",{value:u.c,key:1},t),i.a.createElement("option",{value:u.d,key:2},gettext("by Level"))];return i.a.createElement(b,d({label:gettext("Group indicators"),options:o},r))}},QTZG:function(e,t,r){"use strict";r.r(t);var o,n,i,a,l=r("q1tI"),d=r.n(l),s=r("i8i4"),c=r.n(s),u=r("okNM"),p=(r("qtBC"),r("WtQ/")),m=r("2vnA"),f=r("7O5W"),v=r("IP2g"),h=r("wHSu"),b=r("TSYQ"),g=r.n(b),y=r("Ez0T"),S=r("hzyr"),_=r("0zu5"),E=r("4L+s"),w=r("O6Fj"),O=r.n(w),C=r("y2Vs");function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function P(e,t,r){return t&&k(e.prototype,t),r&&k(e,r),e}function I(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?j(e):t}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}f.b.add(h.b,h.c,h.a);var D,A,z=function(e){function t(){return T(this,t),I(this,x(t).apply(this,arguments))}return L(t,d.a.Component),P(t,[{key:"render",value:function(){return d.a.createElement("h3",{className:"level-title "+this.props.classes},this.props.tierName,this.props.ontologyLabel?" "+this.props.ontologyLabel:null)}}]),t}(),K=function(e){function i(){var e,t;T(this,i);for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];return(t=I(this,(e=x(i)).call.apply(e,[this].concat(o)))).onChange=function(e){t.props.onProgramObjectiveImport(e.value)},t}return L(i,d.a.Component),P(i,[{key:"render",value:function(){var e=this.props.programObjectives;if(0===e.length)return null;var t=e.map(function(e){return{value:e.id,label:e.name}});return d.a.createElement("div",{className:"program-objective-import mb-3"},d.a.createElement(C.default,{placeholder:gettext("Import Program Objective"),onChange:this.onChange,value:"",className:"tola-react-select",options:t,isDisabled:this.props.isDisabled}),d.a.createElement("a",{href:"#",className:"program-objective-import__icon",tabIndex:"0","data-html":"true","data-toggle":"popover","data-placement":"bottom","data-trigger":"focus","data-content":gettext("Import text from a Program Objective. <strong class='program-objective-import__popover-strong-text'>Make sure to remove levels and numbers from your text, because they are automatically displayed.</strong>"),onClick:function(e){return e.preventDefault()}},d.a.createElement("i",{className:"far fa-question-circle"})))}}]),i}(),R=Object(u.b)("rootStore")(o=Object(u.c)(o=function(e){function i(){var e,r;T(this,i);for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];return(r=I(this,(e=x(i)).call.apply(e,[this].concat(o)))).deleteLevel=function(){r.props.rootStore.uiStore.setDisableForPrompt(!0);var e=r.props.levelProps.tierName+" "+r.props.levelProps.ontologyLabel;create_no_rationale_changeset_notice({message_text:interpolate(gettext("Are you sure you want to delete %s?"),[e]),on_submit:function(){return r.props.rootStore.levelStore.deleteLevelFromDB(r.props.level.id)},on_cancel:function(){return r.props.rootStore.uiStore.setDisableForPrompt(!1)}})},r.editLevel=function(){r.props.rootStore.uiStore.editCard(r.props.level.id)},r.buildIPTTUrl=function(e){var t="/indicators/iptt_report/".concat(r.props.rootStore.levelStore.program_id,"/timeperiods/?frequency=3&start=0&end=999");return e.forEach(function(e){return t+="&indicators="+e}),t},r}return L(i,d.a.Component),P(i,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"componentDidUpdate",value:function(e,t,r){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var o=this;if(this.props.rootStore.uiStore.hasVisibleChildren.indexOf(this.props.level.parent)<0&&null!=this.props.level.parent)return null;var e=[],t=this.props.levelProps.indicators.map(function(e){return e.id});if(0<t.length){var r="All indicators linked to ".concat(this.props.levelProps.tierName," ").concat(this.props.levelProps.ontologyLabel);e.push('<li class="nav-item level-card--iptt-links"><a href='.concat(this.buildIPTTUrl(t),">").concat(r,"</a></li>"))}if(this.props.levelProps.tierName!=this.props.rootStore.levelStore.chosenTierSet.slice(-1)[0]){var n=this.props.levelProps.descendantIndicatorIds;if(0<(n=n.concat(t)).length){var i="All indicators linked to ".concat(this.props.levelProps.tierName," ").concat(this.props.levelProps.ontologyLabel," and sub-levels");e.unshift('<li class="nav-item level-card--iptt-links"><a href='.concat(this.buildIPTTUrl(n),">").concat(i,"</a></li>"))}}var a=this.props.levelProps.indicators.sort(function(e,t){return e.level_order-t.level_order}).map(function(e,t){var r="";return o.props.rootStore.levelStore.manual_numbering?o.props.rootStore.levelStore.manual_numbering&&e.number&&(r=e.number+": "):r=o.props.levelProps.ontologyLabel+String.fromCharCode(97+t)+": ",'<li class="nav-item level-card--iptt-links"><a href='.concat(o.buildIPTTUrl([e.id]),">").concat(r).concat(e.name,"</a></li>")});e=e.concat(a);var l='<ul class="nav flex-column">'.concat(e.join(""),"</ul>"),s=this.props.levelProps.indicators.length,c=interpolate(ngettext("%s indicator","%s indicators",s),[s]),u=null;this.props.levelProps.tierName!=Object(m.r)(this.props.rootStore.levelStore.chosenTierSet.slice(-1)[0])&&0<this.props.rootStore.levelStore.levels.filter(function(e){return e.parent==o.props.level.id}).length&&(u=d.a.createElement(v.a,{className:"text-action",icon:0<=this.props.rootStore.uiStore.hasVisibleChildren.indexOf(this.props.level.id)?"caret-down":"caret-right"}));var p=0==e.length||this.props.rootStore.uiStore.disableForPrompt;return d.a.createElement("div",{className:"level-card level-card--collapsed",id:"level-card-".concat(this.props.level.id)},d.a.createElement("div",{className:u?"level-card__toggle":"",onClick:function(e){return o.props.rootStore.uiStore.updateVisibleChildren(o.props.level.id)}},u,d.a.createElement("span",{className:"level-card--collapsed__name"},d.a.createElement(z,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--collapsed"})," ",this.props.level.name)),d.a.createElement("div",{className:"level-card--collapsed__actions"},d.a.createElement("div",{className:"actions__top btn-row"},this.props.levelProps.canDelete&&d.a.createElement("button",{disabled:this.props.rootStore.uiStore.disableForPrompt||this.props.rootStore.uiStore.activeCard,className:"btn btn-sm btn-link btn-danger",onClick:this.deleteLevel},d.a.createElement("i",{className:"fas fa-trash-alt"}),gettext("Delete")),this.props.levelProps.canEdit&&d.a.createElement("button",{disabled:this.props.rootStore.uiStore.disableForPrompt,className:"btn btn-sm btn-link btn-text edit-button",onClick:this.editLevel},d.a.createElement("i",{className:"fas fa-edit"}),gettext("Edit"))),d.a.createElement("div",{className:"actions__bottom"},d.a.createElement("a",{tabIndex:"0",className:g()("btn btn-sm btn-link no-bold",{disabled:p}),"data-toggle":"popover","data-trigger":"focus","data-placement":"bottom","data-html":"true",title:"Track indicator performance","data-content":l},c))))}}]),i}())||o)||o,V=Object(u.b)("rootStore")(n=Object(u.c)(n=function(e){function t(e){var i;return T(this,t),(i=I(this,x(t).call(this,e))).onDragEnd=function(e){var t=e.oldIndex,r=e.newIndex;i.indicatorWasReordered=!0;var o=i.indicators[t].id,n={value:r+1,name:r+1};i.changeIndicatorOrder(o,n)},i.changeIndicatorOrder=function(t,e){var r=i.indicators.find(function(e){return e.id==t}).level_order,o=e.value-1,n=i.indicators.slice();n.splice(o,0,n.splice(r,1)[0]),n.forEach(function(e,t){return e.level_order=t}),i.indicators.replace(n),i.props.rootStore.uiStore.activeCardNeedsConfirm=i.dataHasChanged,i.indicatorWasReordered=!0},i.updateSubmitType=function(e){i.submitType=e},i.saveLevel=function(e){e.preventDefault();var t=function(e){i.props.rootStore.levelStore.saveLevelToDB(i.submitType,i.props.level.id,i.indicatorWasReordered,{name:i.name,assumptions:i.assumptions,rationale:e,indicators:Object(m.r)(i.indicators)})},r=0<i.indicators.length,o=0<i.props.level.assumptions.length&&i.assumptions!=i.props.level.assumptions,n=i.name!=i.props.level.name;r&&(o||n)?create_nondestructive_changeset_notice({on_submit:t,on_cancel:function(){return i.props.rootStore.uiStore.setDisableForPrompt(!1)}}):t("")},i.cancelEdit=function(){1==i.props.rootStore.levelStore.levels.length&&"new"==i.props.level.id?i.clearData():i.props.rootStore.levelStore.cancelEdit(i.props.level.id)},i.clearData=function(){i.name="",i.assumptions=""},i.onFormChange=function(e){if(e.preventDefault(),i[e.target.name]=e.target.value,i.name)$("#level-name-".concat(i.props.level.id)).removeClass("is-invalid"),$("#name-feedback-".concat(i.props.level.id)).remove();else{var t=$("#level-name-".concat(i.props.level.id));t.addClass("is-invalid");var r=gettext("Please complete this field.");t.after("<p id=name-feedback-".concat(i.props.level.id,' class="invalid-feedback">').concat(r,"</p>"))}i.props.rootStore.uiStore.activeCardNeedsConfirm=i.dataHasChanged},i.onProgramObjectiveImport=function(t){var e=i.props.rootStore.levelStore.programObjectives.find(function(e){return e.id===t});null!=e&&(i.name=e.name,i.assumptions=e.description)},i.submitType="saveOnly",i.indicatorWasReordered=!1,i.baseLevelString=JSON.stringify([e.level.name,e.level.assumptions]),i.baseIndicators=i.props.levelProps.indicators.slice().map(function(e){return Object(m.r)(e)}),Object(m.i)(j(j(i)),{name:e.level.name,assumptions:e.level.assumptions,indicators:e.levelProps.indicators.sort(function(e,t){return e.level_order-t.level_order}),get dataHasChanged(){var e=this.baseLevelString+JSON.stringify(this.baseIndicators.sort(function(e,t){return e.id-t.id}));return JSON.stringify([this.name,this.assumptions])+JSON.stringify(Object(m.r)(this.indicators).sort(function(e,t){return e.id-t.id}))!=e},addIndicator:function(e){this.indicators.push(e),this.baseIndicators.push(e)},deleteIndicator:function(t){this.indicators=this.indicators.filter(function(e){return e.id!=t}),this.indicators.forEach(function(e,t){return e.level_order=t}),this.baseIndicators=this.baseIndicators.filter(function(e){return e.id!=t}),this.baseIndicators.forEach(function(e,t){return e.level_order=t})},updateIndicatorName:function(t,e){this.indicators.find(function(e){return e.id==t}).name=e,this.baseIndicators.find(function(e){return e.id==t}).name=e,this.props.rootStore.levelStore.updateIndicatorNameInStore(t,e)}},{addIndicator:m.d,deleteIndicator:m.d,updateIndicatorName:m.d}),i}return L(t,d.a.Component),P(t,[{key:"componentDidUpdate",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"componentDidMount",value:function(){var o=this;$('*[data-toggle="popover"]').popover({html:!0}),$("#indicator_modal_div").on("created.tola.indicator.save",function(e,t){var r={id:t.indicatorId,name:t.indicatorName,level:o.props.level.id,level_order:o.indicators.length};o.props.rootStore.levelStore.addIndicatorToStore(r),o.addIndicator(r)}),$("#indicator_modal_div").on("deleted.tola.indicator.save",function(e,t){o.props.rootStore.levelStore.deleteIndicatorFromStore(t.indicatorId),o.deleteIndicator(t.indicatorId)}),$("#indicator_modal_div").on("updated.tola.indicator.save",function(e,t){o.updateIndicatorName(t.indicatorId,t.indicatorName),t.levelId!=o.props.rootStore.uiStore.activeCard&&(t.levelId&&o.props.rootStore.levelStore.moveIndicatorInStore(t.indicatorId,t.levelId),o.deleteIndicator(t.indicatorId)),$('*[data-toggle="tooltip"]').tooltip("dispose"),$('*[data-toggle="tooltip"]').tooltip()})}},{key:"componentWillUnmount",value:function(){$("#indicator_modal_div").off("updated.tola.indicator.save"),$("#indicator_modal_div").off("deleted.tola.indicator.save"),$("#indicator_modal_div").off("created.tola.indicator.save")}},{key:"render",value:function(){var t=this,e=(Object(m.r)(this.indicators),this.props.rootStore.uiStore.disableForPrompt,this.props.rootStore.levelStore.programObjectives),r="";return r="new"==this.props.level.id?d.a.createElement("div",{className:"form-group"},d.a.createElement("button",{type:"submit",disabled:!(0<this.name.length),className:"btn btn-link btn-lg ",onClick:function(e){t.updateSubmitType("saveAndEnableIndicators")}},d.a.createElement("i",{className:"fas fa-plus-circle"}),interpolate(gettext("Save %s and add indicators"),[this.props.levelProps.tierName]))):d.a.createElement(q,{level:this.props.level,tierName:this.props.levelProps.tierName,indicators:this.indicators,disabled:!this.name||"new"==this.props.level.id||this.props.rootStore.uiStore.disableForPrompt,reorderDisabled:this.indicators.length<2||this.props.rootStore.uiStore.disableForPrompt,changeFunc:this.changeIndicatorOrder,dragEndFunc:this.onDragEnd}),d.a.createElement("div",{className:"level-card level-card--expanded",id:"level-card-".concat(this.props.level.id)},d.a.createElement("div",{className:"d-flex justify-content-between"},d.a.createElement(z,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--expanded"}),d.a.createElement(K,{isDisabled:this.props.rootStore.uiStore.disableForPrompt,programObjectives:e,onProgramObjectiveImport:this.onProgramObjectiveImport})),d.a.createElement("form",{className:"level-card--expanded__form",onSubmit:this.saveLevel},d.a.createElement("div",{className:"form-group"},d.a.createElement(O.a,{className:"form-control",id:"level-name-".concat(this.props.level.id),name:"name",value:this.name||"",disabled:this.props.rootStore.uiStore.disableForPrompt,autoComplete:"off",rows:3,onChange:this.onFormChange,maxLength:500})),d.a.createElement("div",{className:"form-group"},d.a.createElement("label",{htmlFor:"assumptions"},gettext("Assumptions")),d.a.createElement(O.a,{className:"form-control",id:"level-assumptions",disabled:!this.name||this.props.rootStore.uiStore.disableForPrompt,name:"assumptions",autoComplete:"off",value:this.assumptions||"",rows:3,onChange:this.onFormChange})),r,d.a.createElement(B,{level:this.props.level,levelProps:this.props.levelProps,submitFunc:this.updateSubmitType,cancelFunc:this.cancelEdit,nameVal:this.name,tierCount:this.props.rootStore.levelStore.chosenTierSet.length})))}}]),t}())||n)||n,B=Object(u.b)("rootStore")(i=function(e){function t(){return T(this,t),I(this,x(t).apply(this,arguments))}return L(t,d.a.Component),P(t,[{key:"render",value:function(){var e=!this.props.nameVal||this.props.rootStore.uiStore.disableForPrompt,t=null;if(null!=this.props.level.parent&&"root"!=this.props.level.parent){var r=interpolate(gettext("Save and add another %s"),[this.props.levelProps.tierName]);t=d.a.createElement(M,{disabled:e,classes:"btn-primary",icon:"plus-circle",text:r,submitType:"saveAndAddSibling",submitFunc:this.props.submitFunc})}var o=null,n=this.props.rootStore.levelStore.chosenTierSet.length;if(this.props.level.level_depth<n){var i=interpolate(gettext("Save and link %s"),[this.props.levelProps.childTierName]);o=d.a.createElement(M,{disabled:e,classes:"btn btn-primary",icon:"stream",text:i,submitType:"saveAndAddChild",submitFunc:this.props.submitFunc})}return d.a.createElement("div",{className:"button-bar btn-row"},d.a.createElement(M,{disabled:e,classes:"btn-primary",text:gettext("Save and close"),icon:"save",submitType:"saveOnly",submitFunc:this.props.submitFunc}),t,o,d.a.createElement(M,{disabled:this.props.rootStore.uiStore.disableForPrompt,classes:"btn btn-reset",text:gettext("Cancel"),submitType:"cancel",submitFunc:this.props.cancelFunc}))}}]),t}())||i,M=function(e){function t(){return T(this,t),I(this,x(t).apply(this,arguments))}return L(t,d.a.Component),P(t,[{key:"render",value:function(){var e=this,t="cancel"==this.props.submitType?"button":"submit";return d.a.createElement("button",{disabled:this.props.disabled,type:t,className:this.props.classes+" level-button btn btn-sm",onClick:function(){return e.props.submitFunc(e.props.submitType)}},this.props.text)}}]),t}(),q=Object(u.b)("rootStore")(a=function(e){function t(){return T(this,t),I(this,x(t).apply(this,arguments))}return L(t,d.a.Component),P(t,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0}),$('*[data-toggle="tooltip"]').tooltip()}},{key:"componentDidUpdate",value:function(){$('*[data-toggle="tooltip"]').tooltip()}},{key:"render",value:function(){var r=this,o=this.props.indicators.map(function(e,t){return{value:t+1,label:t+1}}),e=this.props.indicators.map(function(t){var e=d.a.createElement("span",{"data-toggle":"tooltip","data-delay":900,"data-template":'<div class="tooltip sortable-list__item__tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',title:t.name},d.a.createElement("span",null,t.name.replace(/(.{55})..+/,"$1...")));return d.a.createElement(d.a.Fragment,null,d.a.createElement(y.d,{update:function(e){return r.props.changeFunc(t.id,e)},selectId:"ind"+t.id,labelClasses:" ",formRowClasses:"sortable-list__item__label",selectClasses:"sortable-list__item__select",value:{value:t.level_order,label:t.level_order+1},label:e,options:o,disabled:r.props.disabled||r.props.reorderDisabled}),d.a.createElement("div",{className:"sortable-list__item__actions"},d.a.createElement(S.b,{readonly:r.props.disabled||r.props.rootStore.uiStore.disableForPrompt,label:gettext("Settings"),indicatorId:t.id})))}),t=null,n=null,i=gettext("To link an already saved indicator to your results framework: Open the indicator from the program page and use the “Result level” menu on the Summary tab."),a=gettext("To remove an indicator: Click “Settings”, where you can reassign the indicator to a different level or delete it."),l=this.props.rootStore.levelStore.usingResultsFramework,s=l?a:i+"<br><br>"+a;return(0<this.props.indicators.length||!l)&&(t="Order",n=d.a.createElement(E.b,{content:s,placement:"bottom"})),d.a.createElement("div",{className:"level-card--indicator-links".concat(this.props.disabled?" disabled":"")},d.a.createElement("div",{className:"indicator-links__header"},d.a.createElement("h4",null,interpolate(gettext("Indicators linked to this %s"),[this.props.tierName])),d.a.createElement("div",null,n)),d.a.createElement("div",{className:"sortable-list-group"},0<this.props.indicators.length?d.a.createElement("div",{className:"sortable-list-header"},d.a.createElement("div",{className:"sortable-list-header__drag-handle"},d.a.createElement(v.a,{icon:h.a})),d.a.createElement("div",{className:"sortable-list-header__label"},t),d.a.createElement("div",{className:"sortable-list-header__actions"},d.a.createElement("i",{className:"fas fa-cog"})," ",gettext("Settings"))):null,d.a.createElement(U,{onSortEnd:this.props.dragEndFunc,useDragHandle:!0,lockAxis:"y",lockToContainerEdges:!0},e.map(function(e,t){return d.a.createElement(H,{key:"item-".concat(t),index:t,value:e,disabled:r.props.disabled||r.props.reorderDisabled})})),d.a.createElement("div",{className:"sortable-list-actions"},d.a.createElement(S.a,{readonly:!this.props.level.id||"new"==this.props.level.id||this.props.disabled||this.props.rootStore.uiStore.disableForPrompt,programId:this.props.rootStore.levelStore.program_id,levelId:this.props.level.id}))))}}]),t}())||a,H=Object(_.sortableElement)(function(e){var t=e.value;return d.a.createElement("li",{className:"sortable-list__item"},d.a.createElement(J,null),t)}),U=Object(_.sortableContainer)(function(e){var t=e.children;return d.a.createElement("ul",{className:"sortable-list"},t)}),J=Object(_.sortableHandle)(function(){return d.a.createElement("div",{className:"sortable-list__item__drag-handle"},d.a.createElement(v.a,{icon:h.a}))});function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function X(e,t,r){return t&&G(e.prototype,t),r&&G(e,r),e}function Y(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}f.b.add(h.b,h.c);var re,oe,ne=Object(u.b)("rootStore")(D=Object(u.c)(D=function(e){function i(){return Q(this,i),Y(this,Z(i).apply(this,arguments))}return ee(i,d.a.Component),X(i,[{key:"render",value:function(){var n=this;return("initial"==this.props.renderList?this.props.rootStore.levelStore.sortedLevels.filter(function(e){return-1!=["root",null].indexOf(e.parent)}):this.props.renderList.sort(function(e,t){return e.customsort-t.customsort})).map(function(t){var e="";e=n.props.rootStore.uiStore.activeCard==t.id?d.a.createElement(V,{level:t,levelProps:n.props.rootStore.levelStore.levelProperties[t.id]}):d.a.createElement(R,{level:t,levelProps:n.props.rootStore.levelStore.levelProperties[t.id]});var r=n.props.rootStore.levelStore.sortedLevels.filter(function(e){return e.parent==t.id}),o=null;return 0<r.length&&(o=d.a.createElement(i,{rootStore:n.props.rootStore,renderList:r})),d.a.createElement("div",{key:t.id,className:"leveltier--new"},e,o)})}}]),i}())||D)||D,ie=Object(u.b)("rootStore")(A=Object(u.c)(A=function(e){function i(){var e,t;Q(this,i);for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];return(t=Y(this,(e=Z(i)).call.apply(e,[this].concat(o)))).getWarningText=function(){return{__html:gettext('<strong class="text-danger">Choose your results framework template carefully!</strong> Once you begin building your framework, it will not be possible to change templates without first deleting all saved levels.')}},t}return ee(i,d.a.Component),X(i,[{key:"render",value:function(){return 0==this.props.rootStore.levelStore.levels.length?d.a.createElement("div",{className:"level-list-panel"},d.a.createElement("div",{className:"level-list-panel__dingbat"},d.a.createElement("i",{className:"fas fa-sitemap"})),d.a.createElement("div",{className:"level-list-panel__text text-large",dangerouslySetInnerHTML:this.getWarningText()})):d.a.createElement("div",{id:"level-list",style:{flexGrow:"2"}},d.a.createElement(ne,{renderList:"initial"}))}}]),i}())||A)||A;function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function se(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ce(e,t,r){return t&&se(e.prototype,t),r&&se(e,r),e}function ue(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function pe(e){return(pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function de(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&me(e,t)}function me(e,t){return(me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fe,ve,he,be,ge,ye,Se,_e,Ee,we,Oe,Ce,Ne,Te,ke,Pe,Ie,je,xe,Le,Fe,De=Object(u.b)("rootStore")(re=Object(u.c)(re=function(e){function i(){var e,t;le(this,i);for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];return(t=ue(this,(e=pe(i)).call.apply(e,[this].concat(o)))).handleChange=function(e){t.props.rootStore.levelStore.changeTierSet(e.value)},t}return de(i,d.a.Component),ce(i,[{key:"componentDidUpdate",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var e=null;"locked"==this.props.rootStore.uiStore.tierLockStatus?e=d.a.createElement("a",{href:"#",tabIndex:"0","data-toggle":"popover","data-trigger":"focus","data-html":"true","data-content":gettext('<span class="text-danger"><strong>The results framework template cannot be changed after levels are saved.</strong></span> To change templates, all saved levels first must be deleted.  A level can be deleted when it has no sub-levels and no linked indicators.')},d.a.createElement("i",{className:"far fa-question-circle"})):"primed"==this.props.rootStore.uiStore.tierLockStatus&&(e=d.a.createElement("a",{href:"#",tabIndex:"0","data-toggle":"popover","data-trigger":"focus","data-html":"true","data-content":gettext('<span class="text-danger"><strong>Choose your results framework template carefully!</strong></span> Once you begin building your framework, it will not be possible to change templates without first deleting all saved levels.')},d.a.createElement("i",{className:"far fa-question-circle"})));var t=this.props.rootStore.levelStore.tierTemplates,r=Object.keys(t).sort().map(function(e){return{value:e,label:t[e].name}}),o={value:this.props.rootStore.levelStore.chosenTierSetKey,label:this.props.rootStore.levelStore.chosenTierSetName},n="leveltier-picker__selectbox ";return n+="locked"==this.props.rootStore.uiStore.tierLockStatus?"leveltier-picker__selectbox--disabled":"",d.a.createElement("div",{className:n},d.a.createElement("div",{className:"form-group"},d.a.createElement("label",null,gettext("Results framework template"))," ",d.a.createElement("small",null,e),d.a.createElement(C.default,{options:r,value:o,isDisabled:"locked"==this.props.rootStore.uiStore.tierLockStatus,onChange:this.handleChange})))}}]),i}())||re)||re,Ae=function(e){function t(){return le(this,t),ue(this,pe(t).apply(this,arguments))}return de(t,d.a.Component),ce(t,[{key:"render",value:function(){return d.a.createElement("div",{className:"leveltier leveltier--level-"+this.props.tierLevel},this.props.tierName," ")}}]),t}(),$e=Object(u.b)("rootStore")(oe=Object(u.c)(oe=function(e){function t(){return le(this,t),ue(this,pe(t).apply(this,arguments))}return de(t,d.a.Component),ce(t,[{key:"render",value:function(){var e=null;return 0==this.props.rootStore.levelStore.levels.length&&(e=d.a.createElement("button",{className:"leveltier-button btn btn-primary btn-block",onClick:this.props.rootStore.levelStore.createFirstLevel},gettext("Apply"))),d.a.createElement(d.a.Fragment,null,d.a.createElement("div",{id:"leveltier-list",className:"leveltier-list"},0<this.props.rootStore.levelStore.chosenTierSet.length?this.props.rootStore.levelStore.chosenTierSet.map(function(e,t){return d.a.createElement(Ae,{key:t,tierLevel:t,tierName:e})}):null),e?d.a.createElement("div",{className:"leveltier-list__actions"},e):null)}}]),t}())||oe)||oe,ze=function(e){var t=e.programId,r="/tola_management/audit_log/".concat(t,"/");return d.a.createElement("div",{className:"leveltier-picker__change-log-link-box"},d.a.createElement("a",{href:r,className:"btn-link"},d.a.createElement("i",{className:"fas fa-history"})," ",gettext("Change log")))},Ke=Object(u.b)("rootStore")(Object(u.c)(function(e){return d.a.createElement("div",{id:"leveltier-picker",className:"leveltier-picker"},d.a.createElement("div",{className:"leveltier-picker__panel"},d.a.createElement(De,null),d.a.createElement($e,null)),d.a.createElement(ze,{programId:e.rootStore.levelStore.program_id}))})),Re=r("XoI5");function Ve(e,t,r,o){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(o):void 0})}function Be(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Me(e,t,r){return t&&Be(e.prototype,t),r&&Be(e,r),e}function qe(r,o,e,t,n){var i={};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=e.slice().reverse().reduce(function(e,t){return t(r,o,e)||e},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(r,o,i),i=null),i}function He(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ue=(ve=qe((fe=function(){function d(e,t,r,o,n,i,a,l,s,c){var u=this;if(He(this,d),Ve(this,"levels",ve,this),Ve(this,"indicators",he,this),Ve(this,"chosenTierSetKey",be,this),Ve(this,"chosenTierSet",ge,this),this.program_id=void 0,this.tierTemplates=void 0,this.programObjectives=void 0,this.defaultTemplateKey="",this.customTierSetKey="",this.accessLevel=!1,this.usingResultsFramework=void 0,this.monitorHeaderLink=Object(m.e)(function(e){var t=$("#rf_builder_header"),r=0<t.children("a").length;if(0<u.indicators.length&&!r){var o=t.text();t.html('<a href="/program/'.concat(u.program_id,'/">').concat(o,"</a>"))}else if(0==u.indicators.length&&r){var n=$("#rf_builder_header > a").text();t.text(n)}},{delay:50}),Ve(this,"cancelEdit",ye,this),Ve(this,"createNewLevelFromSibling",Se,this),Ve(this,"createNewLevelFromParent",_e,this),Ve(this,"createFirstLevel",Ee,this),this.saveLevelTiersToDB=function(){var e={program_id:u.program_id};"custom"===u.chosenTierSetKey?e.tiers=u.chosenTierSet:e.tiers=u.englishTierTemlates[u.chosenTierSetKey].tiers,Re.a.post("/save_leveltiers/",e).then(function(e){}).catch(function(e){})},this.deleteLevelFromDB=function(e){var t="".concat(u.levelProperties[e].tierName," ").concat(u.levelProperties[e].ontologyLabel);Re.a.delete("/level/".concat(e)).then(function(e){u.levels.replace(e.data),u.rootStore.uiStore.activeCard=null,0==u.levels.length&&u.createFirstLevel(),success_notice({message_text:interpolate(gettext("%s was deleted."),[t]),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}})}).catch(function(e){}),u.rootStore.uiStore.setDisableForPrompt(!1)},this.saveLevelToDB=function(r,t,o,e){o&&u.saveReorderedIndicatorsToDB(e.indicators),delete e.indicators;var n=u.levels.find(function(e){return e.id==t}),i="".concat(u.levelProperties[t].tierName," ").concat(u.levelProperties[t].ontologyLabel),a=Object.assign(Object(m.r)(n),e),l=u.rootStore.uiStore.activeCardNeedsConfirm;"new"==t?("root"==a.parent&&(u.saveLevelTiersToDB(),$("#logframe_link").show()),delete a.id,delete a.rationale,Re.a.post("/insert_new_level/",a).then(function(e){Object(m.p)(function(){u.levels.replace(e.data.all_data)}),success_notice({message_text:interpolate(gettext("%s saved."),[i]),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}});var t=e.data.new_level.id;u.rootStore.uiStore.activeCard=null,"saveAndEnableIndicators"==r?Object(m.p)(function(){u.rootStore.uiStore.activeCard=t}):"saveAndAddSibling"==r?u.createNewLevelFromSibling(t):"saveAndAddChild"==r&&u.createNewLevelFromParent(t)}).catch(function(e){})):Re.a.put("/level/".concat(t,"/"),a).then(function(e){(l||o)&&success_notice({message_text:interpolate(gettext("%s updated."),[i]),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}}),Object(m.p)(function(){Object.assign(n,e.data)}),u.rootStore.uiStore.activeCard=null,"saveAndAddSibling"==r?u.createNewLevelFromSibling(t):"saveAndAddChild"==r&&u.createNewLevelFromParent(t)}).catch(function(e){}),u.fetchIndicatorsFromDB(),u.rootStore.uiStore.activeCardNeedsConfirm=!1},this.saveReorderedIndicatorsToDB=function(e){Re.a.post("/reorder_indicators/",e).then(function(e){u.fetchIndicatorsFromDB()}).catch(function(e){})},Ve(this,"deleteIndicatorFromStore",we,this),Ve(this,"addIndicatorToStore",Oe,this),Ve(this,"moveIndicatorInStore",Ce,this),this.fetchIndicatorsFromDB=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=e?"?indicatorId=".concat(e):"";Re.a.get("/indicator_list/".concat(u.program_id,"/").concat(t)).then(function(e){return Object(m.p)(function(){u.indicators=e.data})}).catch(function(e){})},this.deriveTemplateKey=function(e){var t=JSON.stringify(Object(m.r)(e));for(var r in u.englishTierTemlates){if(u.englishTierTemlates.hasOwnProperty(r)&&e.length==u.englishTierTemlates[r].tiers.length)if(t==JSON.stringify(u.englishTierTemlates[r].tiers))return r}return u.customTierSetKey},this.buildOntology=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=Object(m.r)(u.levels.find(function(e){return e.id==t}));return r.parent&&"root"!=r.parent?(e.unshift(r.customsort),u.buildOntology(r.parent,e)):e.join(".")},this.getChildLevels=function(t){return u.levels.filter(function(e){return e.parent==t})},this.getLevelIndicators=function(t){return u.indicators.filter(function(e){return e.level==t})},this.getDescendantIndicatorIds=function(t){var e=u.levels.filter(function(e){return t.includes(e.id)}),r=[];return e.forEach(function(t){r=r.concat(u.indicators.filter(function(e){return e.level==t.id}).map(function(e){return e.id}));var e=u.levels.filter(function(e){return e.parent==t.id}).map(function(e){return e.id});r=r.concat(u.getDescendantIndicatorIds(e,r))}),r},this.rootStore=c,this.levels=t,this.indicators=r,this.tierTemplates=JSON.parse(n),this.englishTierTemlates=JSON.parse(i),this.defaultTemplateKey="mc_standard",this.customTierSetKey="custom",this.program_id=e.id,this.manual_numbering=e.manual_numbering,this.programObjectives=a,this.accessLevel=l,0<o.length){var p=o.map(function(e){return e.name});this.chosenTierSetKey=this.deriveTemplateKey(p),this.chosenTierSetKey==this.customTierSetKey?this.chosenTierSet=o.map(function(e){return e.name}):this.chosenTierSet=this.tierTemplates[this.chosenTierSetKey].tiers}else this.chosenTierSetKey=this.defaultTemplateKey,this.chosenTierSet=this.tierTemplates[this.chosenTierSetKey].tiers;this.usingResultsFramework=s}return Me(d,[{key:"changeTierSet",value:function(e){this.chosenTierSetKey=e,this.chosenTierSet=this.tierTemplates[e].tiers}},{key:"updateIndicatorNameInStore",value:function(t,e){this.indicators.find(function(e){return e.id==t}).name=e}},{key:"sortedLevels",get:function(){return this.levels.slice().sort(function(e,t){e.level_depth-t.level_depth||(e.customsort,t.customsort)})}},{key:"levelProperties",get:function(){var n=this,i={},e=!0,t=!1,r=void 0;try{for(var a,o=function(){var t=a.value,e={},r=n.getChildLevels(t.id).map(function(e){return e.id}),o=n.indicators.filter(function(e){return e.level==t.id});e.indicators=n.getLevelIndicators(t.id),e.descendantIndicatorIds=n.getDescendantIndicatorIds(r),e.ontologyLabel=n.buildOntology(t.id),e.tierName=n.chosenTierSet[t.level_depth-1],e.childTierName=null,n.chosenTierSet.length>t.level_depth&&(e.childTierName=n.chosenTierSet[t.level_depth]),e.canDelete=0==r.length&&0==o&&"high"==n.accessLevel,e.canEdit="high"==n.accessLevel,i[t.id]=e},l=this.levels[Symbol.iterator]();!(e=(a=l.next()).done);e=!0)o()}catch(e){t=!0,r=e}finally{try{e||null==l.return||l.return()}finally{if(t)throw r}}return i}},{key:"chosenTierSetName",get:function(){return this.chosenTierSetKey==this.customTierSetKey?gettext("Custom"):this.tierTemplates[this.chosenTierSetKey].name}}]),d}()).prototype,"levels",[m.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),he=qe(fe.prototype,"indicators",[m.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),be=qe(fe.prototype,"chosenTierSetKey",[m.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ge=qe(fe.prototype,"chosenTierSet",[m.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qe(fe.prototype,"sortedLevels",[m.f],Object.getOwnPropertyDescriptor(fe.prototype,"sortedLevels"),fe.prototype),qe(fe.prototype,"levelProperties",[m.f],Object.getOwnPropertyDescriptor(fe.prototype,"levelProperties"),fe.prototype),qe(fe.prototype,"chosenTierSetName",[m.f],Object.getOwnPropertyDescriptor(fe.prototype,"chosenTierSetName"),fe.prototype),qe(fe.prototype,"changeTierSet",[m.d],Object.getOwnPropertyDescriptor(fe.prototype,"changeTierSet"),fe.prototype),ye=qe(fe.prototype,"cancelEdit",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){if("new"==t){var r=e.levels.find(function(e){return e.id==t});e.levels.filter(function(e){return e.customsort>r.customsort&&e.parent==r.parent}).forEach(function(e){return e.customsort-=1}),e.levels.replace(e.levels.filter(function(e){return"new"!=e.id}))}e.fetchIndicatorsFromDB(),e.rootStore.uiStore.removeActiveCard()}}}),Se=qe(fe.prototype,"createNewLevelFromSibling",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var o=this;return function(t){var r=Object(m.r)(o.levels.find(function(e){return e.id==t})),e=Object.assign({},r);e.customsort+=1,e.id="new",e.name="",e.assumptions="",o.levels.filter(function(e){return r&&e.customsort>r.customsort&&e.parent==r.parent}).forEach(function(e){return e.customsort+=1}),o.rootStore.uiStore.activeCard="new",o.levels.push(e),setTimeout(function(){$("#level-card-new")[0].scrollIntoView({behavior:"smooth"})},100)}}}),_e=qe(fe.prototype,"createNewLevelFromParent",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var o=this;return function(t){var e=Object(m.r)(o.levels.find(function(e){return e.id==t})),r={id:"new",customsort:1,name:"",assumptions:"",parent:t,level_depth:e.level_depth+1,program:o.program_id};o.levels.filter(function(e){return e.parent==t}).forEach(function(e){return e.customsort+=1}),o.levels.push(r),o.rootStore.uiStore.activeCard="new",o.rootStore.uiStore.hasVisibleChildren.push(r.parent)}}}),Ee=qe(fe.prototype,"createFirstLevel",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e={id:"new",program:t.program_id,name:"",assumptions:"",customsort:1,level_depth:1,parent:"root"};t.levels.push(e),t.rootStore.uiStore.activeCard="new"}}}),qe(fe.prototype,"updateIndicatorNameInStore",[m.d],Object.getOwnPropertyDescriptor(fe.prototype,"updateIndicatorNameInStore"),fe.prototype),we=qe(fe.prototype,"deleteIndicatorFromStore",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,r){e.indicators=e.indicators.filter(function(e){return e.id!=t}),e.indicators.filter(function(e){return e.level==r}).sort(function(e,t){return e.level_order-t.level_order}).forEach(function(e,t){return e.level_order=t})}}}),Oe=qe(fe.prototype,"addIndicatorToStore",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){t.indicators.push(e)}}}),Ce=qe(fe.prototype,"moveIndicatorInStore",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var o=this;return function(t,r){var e=o.indicators.find(function(e){return e.id==t});e.level=r,e.level_order=o.indicators.filter(function(e){return e.level==r}).length-1}}}),fe),Je=(Te=qe((Ne=function(){function t(e){He(this,t),Ve(this,"activeCard",Te,this),Ve(this,"hasVisibleChildren",ke,this),Ve(this,"disableForPrompt",Pe,this),this.activeCardNeedsConfirm="",Ve(this,"editCard",Ie,this),Ve(this,"onLeaveConfirm",je,this),Ve(this,"setDisableForPrompt",xe,this),Ve(this,"removeActiveCard",Le,this),Ve(this,"updateVisibleChildren",Fe,this),this.rootStore=e,this.hasVisibleChildren=this.rootStore.levelStore.levels.map(function(e){return e.id}),this.activeCardNeedsConfirm=!1,this.activeCard=null,this.disableForPrompt=!1}return Me(t,[{key:"tierLockStatus",get:function(){return 0<this.rootStore.levelStore.levels.filter(function(e){return"new"!=e.id}).length?"locked":1==this.rootStore.levelStore.levels.length?"primed":null}}]),t}()).prototype,"activeCard",[m.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ke=qe(Ne.prototype,"hasVisibleChildren",[m.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Pe=qe(Ne.prototype,"disableForPrompt",[m.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qe(Ne.prototype,"tierLockStatus",[m.f],Object.getOwnPropertyDescriptor(Ne.prototype,"tierLockStatus"),Ne.prototype),Ie=qe(Ne.prototype,"editCard",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var o=this;return function(e){var t=o.activeCard;if(o.activeCardNeedsConfirm){o.setDisableForPrompt(!0),$("#level-card-".concat(o.activeCard))[0].scrollIntoView({behavior:"smooth"});var r=o.rootStore.levelStore.levelProperties[o.activeCard].tierName;create_no_rationale_changeset_notice({message_text:gettext("Are you sure you want to continue?"),preamble:interpolate(gettext("Changes to this %s will not be saved"),[r]),type:"notice",on_submit:function(){return o.onLeaveConfirm(e,t)},on_cancel:function(){return o.setDisableForPrompt(!1)}})}else o.activeCard=e,o.rootStore.levelStore.levels.replace(o.rootStore.levelStore.levels.filter(function(e){return"new"!=e.id}))}}}),je=qe(Ne.prototype,"onLeaveConfirm",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(e,t){r.setDisableForPrompt(!1),r.rootStore.levelStore.cancelEdit(t),r.activeCardNeedsConfirm=!1,r.activeCard=e,setTimeout(function(){$("#level-card-".concat(e))[0].scrollIntoView({behavior:"smooth"})},100)}}}),xe=qe(Ne.prototype,"setDisableForPrompt",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){t.disableForPrompt=e}}}),Le=qe(Ne.prototype,"removeActiveCard",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.activeCard=null,e.rootStore.uiStore.activeCardNeedsConfirm=!1}}}),Fe=qe(Ne.prototype,"updateVisibleChildren",[m.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];2<arguments.length&&void 0!==arguments[2]&&arguments[2];0<=r.hasVisibleChildren.indexOf(t)||e?(r.hasVisibleChildren=r.hasVisibleChildren.filter(function(e){return e!=t}),r.rootStore.levelStore.levels.filter(function(e){return e.parent==t}).forEach(function(e){return r.updateVisibleChildren(e.id,!0)})):r.hasVisibleChildren.push(t)}}}),Ne),We=jsContext,Qe=new function e(t,r,o,n,i,a,l,s,c){He(this,e),this.levelStore=new Ue(t,r,o,n,i,a,l,s,c,this),this.uiStore=new Je(this)}(We.program,We.levels,We.indicators,We.levelTiers,We.tierTemplates,We.englishTemplates,We.programObjectives,We.accessLevel,We.usingResultsFramework);c.a.render(d.a.createElement(u.a,{rootStore:Qe},d.a.createElement(d.a.Fragment,null,d.a.createElement(Ke,null),d.a.createElement(ie,null))),document.querySelector("#level-builder-react-component")),Object(p.d)()},"WtQ/":function(e,t,r){"use strict";function o(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;if(5==t)return e;var r=[];return e.forEach(function(e){Array.isArray(e)?r=r.concat(o(e,t+1)):r.push(e)}),r}function n(e){if(!Array.isArray(e))return!(!(e=parseInt(e))||isNaN(e))&&[e];var t=e.map(function(e){return parseInt(e)}).filter(function(e){return!isNaN(e)});return!!(t&&Array.isArray(t)&&0<t.length)&&t}function i(){$(function(){var e=0===window.performance.getEntriesByType("navigation")[0].transferSize,t="reload"===window.performance.getEntriesByType("navigation")[0].type;e&&!t&&window.location.reload()})}r.d(t,"b",function(){return o}),r.d(t,"a",function(){return n}),r.d(t,"d",function(){return i}),r.d(t,"c",function(){return a});var a=function(s,c){return function(e,t){var r=s(e),o=s(t);if(r&&!o)return 1;if(o&&!r)return-1;if(r!=o)return parseInt(r)-parseInt(o);for(var n=(c(e)||"").split("."),i=(c(t)||"").split("."),a=0;a<Math.max(n.length,i.length);a++)if(n[a]&&i[a])for(var l=0;l<Math.max(n[a].length,i[a].length);l++)if(n[a][l]&&i[a][l]){if(n[a].charCodeAt(l)!=i[a].charCodeAt(l))return n[a].charCodeAt(l)-i[a].charCodeAt(l)}else{if(n[a][l])return 1;if(i[a][l])return-1}else{if(n[a])return 1;if(i[a])return-1}return 0}}},XoI5:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var o=r("vDqi"),n=r.n(o).a.create({withCredentials:!0,baseURL:"/api/",headers:{"X-CSRFToken":document.cookie.replace(/(?:(?:^|.*;\s*)csrftoken\s*\=\s*([^;]*).*$)|^.*$/,"$1")}})},hzyr:function(e,t,r){"use strict";r.d(t,"a",function(){return l}),r.d(t,"b",function(){return s});var o=r("q1tI"),i=r.n(o),n=r("okNM");function a(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=Object(n.c)(function(e){var t=e.readonly,r=a(e,["readonly"]);return i.a.createElement("button",{type:"button",disabled:t,className:"btn btn-link btn-add",onClick:function(e){openCreateIndicatorFormModal(r)}},i.a.createElement("i",{className:"fas fa-plus-circle"})," ",gettext("Add indicator"))}),s=Object(n.c)(function(e){var t=e.readonly,r=e.label,o=void 0===r?null:r,n=a(e,["readonly","label"]);return i.a.createElement("button",{type:"button",disabled:t,className:"btn btn-link",onClick:function(e){openUpdateIndicatorFormModal(n)}},i.a.createElement("i",{className:"fas fa-cog"}),o)})},qtBC:function(e,t,r){"use strict";var o=r("7+Rn"),n=r.n(o)()();t.a=n},v38i:function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"b",function(){return n}),r.d(t,"h",function(){return i}),r.d(t,"f",function(){return a}),r.d(t,"g",function(){return l}),r.d(t,"c",function(){return s}),r.d(t,"d",function(){return c}),r.d(t,"i",function(){return p}),r.d(t,"e",function(){return d});var o={value:null,label:"---------"},n="—",i=1,a=2,l=[3,4,5,6,7],s=1,c=2,u="undefined"!=typeof gettext?gettext:function(e){return e};function p(){return{targetperiodLabels:{1:u("Life of Program (LoP) only"),3:u("Annual"),2:u("Midline and endline"),5:u("Tri-annual"),4:u("Semi-annual"),7:u("Monthly"),6:u("Quarterly")},timeperiodLabels:{3:u("Years"),5:u("Tri-annual periods"),4:u("Semi-annual periods"),7:u("Months"),6:u("Quarters")}}}var d={NO_INDICATOR_IN_UPDATE:1}}},[["QTZG",0,1]]]);